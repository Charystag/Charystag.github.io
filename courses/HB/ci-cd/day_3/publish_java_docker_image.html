<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Publication Image Java - CI-CD</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Day 1</li><li class="chapter-item expanded "><a href="../day_1/Github-actions-guided.html"><strong aria-hidden="true">1.</strong> Github Actions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../day_1/Github-actions-non-guided.html"><strong aria-hidden="true">1.1.</strong> non guided</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Day 2</li><li class="chapter-item expanded "><a href="../day_2/tests_java.html"><strong aria-hidden="true">2.</strong> Tests Java</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../day_2/tests_java_non_guide.html"><strong aria-hidden="true">2.1.</strong> non guided</a></li></ol></li><li class="chapter-item expanded "><a href="../day_2/tutoriels_docker.html"><strong aria-hidden="true">3.</strong> Tutoriels Docker</a></li><li class="chapter-item expanded affix "><li class="part-title">Day 3</li><li class="chapter-item expanded "><a href="../day_3/dockerize_java_app.html"><strong aria-hidden="true">4.</strong> Dockerisation Application Java</a></li><li class="chapter-item expanded "><a href="../day_3/tutoriel_github_actions.html"><strong aria-hidden="true">5.</strong> Tutoriel Github Actions</a></li><li class="chapter-item expanded "><a href="../day_3/publish_java_docker_image.html" class="active"><strong aria-hidden="true">6.</strong> Publication Image Java</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CI-CD</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="exercice-pratique-2--publication-automatisée-dimages-docker-avec-github-actions"><a class="header" href="#exercice-pratique-2--publication-automatisée-dimages-docker-avec-github-actions">Exercice Pratique 2 : Publication Automatisée d'Images Docker avec GitHub Actions</a></h1>
<p><strong>Objectif Général :</strong>
Cet exercice a pour but de vous apprendre à automatiser la construction et la publication de vos images Docker vers GitHub Container Registry (GHCR) en utilisant un workflow GitHub Actions, avec un accent sur des conditions de déclenchement spécifiques.</p>
<p><strong>Contexte :</strong>
Vous avez préalablement dockerisé l'application <code>maSuperAppJava</code> et disposez d'un <code>Dockerfile</code> fonctionnel à la racine de votre projet. Votre projet est versionné avec Git et hébergé sur GitHub.</p>
<p><strong>Prérequis :</strong></p>
<ul>
<li>L'exercice 1 ("Évolution et Conteneurisation d'une Application Java") doit être complété avec succès.</li>
<li>Votre projet Java, incluant le <code>Dockerfile</code>, doit être poussé sur votre dépôt GitHub distant.</li>
<li>Vous devez avoir une compréhension de base du fonctionnement des GitHub Actions.</li>
<li><strong>Il est fortement recommandé d'avoir consulté et compris le tutoriel officiel de GitHub : <a href="https://docs.github.com/en/actions/publishing-packages/publishing-docker-images">Publishing Docker images</a>. Cet exercice s'appuie sur les concepts qui y sont présentés.</strong></li>
</ul>
<hr />
<h2 id="instructions--mise-en-place-du-workflow-github-actions"><a class="header" href="#instructions--mise-en-place-du-workflow-github-actions">Instructions : Mise en Place du Workflow GitHub Actions</a></h2>
<p>Vous allez créer un workflow GitHub Actions qui se chargera de construire l'image Docker de votre application et de la publier sur GitHub Container Registry, uniquement lorsque des modifications pertinentes sont apportées aux branches principales.</p>
<ol>
<li>
<p><strong>Création du Fichier de Workflow :</strong></p>
<ul>
<li>Dans votre dépôt GitHub, au sein du répertoire <code>.github/workflows/</code>, créez un nouveau fichier YAML pour votre workflow (par exemple, <code>publish-docker-image.yml</code>).</li>
</ul>
</li>
<li>
<p><strong>Définition du Déclencheur :</strong></p>
<ul>
<li>Configurez le workflow pour qu'il se déclenche <strong>uniquement</strong> dans les conditions suivantes :
<ul>
<li>L'événement est un <code>push</code>.</li>
<li>Le <code>push</code> est effectué sur votre branche de développement principale (généralement <code>main</code> ou <code>master</code>).</li>
<li><strong>ET</strong> au moins un des fichiers modifiés dans ce <code>push</code> est un fichier source Java de votre application (par exemple, les fichiers avec l'extension <code>.java</code> situés dans vos répertoires <code>src/main/java</code> ou <code>src/test/java</code>).</li>
</ul>
</li>
<li>Pour vous aider à configurer ces conditions de déclenchement précises, référez-vous à la documentation GitHub sur les événements qui déclenchent les workflows, en particulier la section concernant l'événement <code>push</code> : <a href="https://docs.github.com/en/actions/writing-workflows/choosing-when-your-workflow-runs/events-that-trigger-workflows#push">GitHub Docs - Events that trigger workflows #push</a>.</li>
</ul>
</li>
<li>
<p><strong>Conception du Job de Publication :</strong></p>
<ul>
<li>Définissez un job unique (par exemple, <code>build-and-publish</code>) qui s'exécutera sur un runner hébergé par GitHub (<code>ubuntu-latest</code> est un choix courant).</li>
<li>Ce job devra comprendre les étapes suivantes :
<ul>
<li><strong>Récupération du Code (<code>checkout</code>) :</strong> Intégrez une étape pour cloner le code source de votre dépôt.</li>
<li><strong>Connexion à GHCR :</strong> Implémentez une étape pour vous authentifier auprès de GitHub Container Registry. Référez-vous à la documentation de l'action <code>docker/login-action</code>. L'authentification utilisera typiquement le <code>GITHUB_TOKEN</code> fourni par GitHub Actions.</li>
<li><strong>Extraction des Métadonnées de l'Image :</strong> Pour taguer votre image de manière dynamique et cohérente, utilisez une action comme <code>docker/metadata-action</code>. Configurez-la pour générer des tags pertinents pour les images construites à partir des branches principales (par exemple, un tag <code>latest</code>, le nom de la branche, ou le SHA du commit).</li>
<li><strong>Construction et Publication de l'Image :</strong> Ajoutez l'étape finale pour construire votre image Docker à partir de votre <code>Dockerfile</code> et la pousser (publier) vers GitHub Container Registry. L'action <code>docker/build-push-action</code> est conçue pour cela.
<ul>
<li>Assurez-vous que le nom de l'image respecte la convention de GHCR (généralement <code>ghcr.io/VOTRE_NOM_UTILISATEUR_OU_ORGANISATION/NOM_DE_VOTRE_DEPOT:TAG</code> ou similaire, que l'action de métadonnées peut aider à formuler).</li>
<li>Configurez cette étape pour utiliser les tags générés par l'action de métadonnées.</li>
<li>Spécifiez que le <code>push</code> doit être effectué (<code>push: true</code>).</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Commit et Push du Workflow :</strong></p>
<ul>
<li>Une fois votre fichier de workflow rédigé, commitez-le et poussez-le vers votre dépôt GitHub.</li>
</ul>
</li>
</ol>
<hr />
<h2 id="validation-"><a class="header" href="#validation-">Validation :</a></h2>
<ol>
<li>
<p><strong>Test des Conditions de Déclenchement :</strong></p>
<ul>
<li>Après avoir poussé votre workflow, effectuez les tests suivants pour valider sa logique de déclenchement :
<ul>
<li><strong>Test 1 :</strong> Modifiez un fichier non-Java (par exemple, <code>README.md</code>) et poussez cette modification sur votre branche principale (<code>main</code> ou <code>master</code>). Le workflow <strong>ne devrait pas</strong> se déclencher.</li>
<li><strong>Test 2 :</strong> Modifiez un fichier source Java (par exemple, <code>App.java</code> ou <code>Calculatrice.java</code>) et poussez cette modification sur votre branche principale. Le workflow <strong>devrait</strong> se déclencher.</li>
<li><strong>Test 3 :</strong> Créez une nouvelle branche, modifiez un fichier source Java et poussez cette modification sur cette nouvelle branche. Le workflow <strong>ne devrait pas</strong> se déclencher.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Surveillance de l'Exécution (si déclenché) :</strong></p>
<ul>
<li>Si le workflow s'est déclenché (Test 2), rendez-vous dans l'onglet "Actions" de votre dépôt GitHub.</li>
<li>Observez l'exécution de votre workflow. Vérifiez que chaque étape se déroule comme prévu et que le workflow se termine avec succès.</li>
</ul>
</li>
<li>
<p><strong>Vérification sur GHCR :</strong></p>
<ul>
<li>Accédez à la section "Packages" de votre profil utilisateur ou de votre organisation sur GitHub.</li>
<li>Confirmez que votre image Docker y a été publiée avec les bons tags (par exemple, <code>latest</code>, le SHA du commit, ou le nom de la branche).</li>
</ul>
</li>
<li>
<p><strong>(Recommandé) Test de l'Image Publiée :</strong></p>
<ul>
<li>Sur votre machine locale (ou tout autre environnement ayant accès à internet et Docker), essayez de tirer l'image fraîchement publiée depuis GHCR :
<code>docker pull ghcr.io/VOTRE_NOM_UTILISATEUR/NOM_IMAGE:TAG</code></li>
<li>Exécutez un conteneur à partir de cette image pour confirmer qu'elle est fonctionnelle :
<code>docker run --rm ghcr.io/VOTRE_NOM_UTILISATEUR/NOM_IMAGE:TAG &lt;argument1&gt; &lt;argument2&gt;</code>
(N'oubliez pas les arguments si votre application en attend).</li>
</ul>
</li>
</ol>
<hr />
<p><strong>Livrables Attendus :</strong></p>
<ul>
<li>Le fichier YAML du workflow GitHub Actions (par exemple, <code>.github/workflows/publish-docker-image.yml</code>) commité et poussé sur votre dépôt.</li>
</ul>
<p><strong>Critères de Validation :</strong></p>
<ul>
<li>Le workflow GitHub Actions se déclenche <strong>uniquement</strong> lorsque des fichiers source Java sont modifiés lors d'un <code>push</code> sur la branche <code>main</code> (ou <code>master</code>).</li>
<li>Toutes les étapes du workflow (checkout, login, build, push) s'exécutent avec succès dans l'onglet "Actions" lorsque le workflow est correctement déclenché.</li>
<li>L'image Docker de votre application est visible et accessible dans la section "Packages" de votre dépôt sur GitHub Container Registry, avec des tags appropriés reflétant la source de la construction (par exemple, <code>latest</code>, SHA du commit, nom de la branche).</li>
<li>L'image Docker tirée depuis GHCR peut être exécutée avec succès et l'application fonctionne comme prévu.</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../day_3/tutoriel_github_actions.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../day_3/tutoriel_github_actions.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
