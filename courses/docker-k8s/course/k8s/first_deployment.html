<!DOCTYPE HTML>
<html lang="fr" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Premier Deploiement - Docker-K8s</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../course/part1/intro.html"><strong aria-hidden="true">1.</strong> Introduction à Docker</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../course/part1/contenerisation.html"><strong aria-hidden="true">1.1.</strong> Histoire de la conteneurisation</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Docker</li><li class="chapter-item expanded "><a href="../../exercises/docker/first_image.html"><strong aria-hidden="true">2.</strong> Premiere image node</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/first_bind_mount.html"><strong aria-hidden="true">3.</strong> Premier serveur nginx</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/image_by_hand.html"><strong aria-hidden="true">4.</strong> Image a la main</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/flask_app.html"><strong aria-hidden="true">5.</strong> Flask Application</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/first_app.html"><strong aria-hidden="true">6.</strong> Premier Network</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/mp3_download.html"><strong aria-hidden="true">7.</strong> Telechargement de mp3 sur youtube</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/unknown_language.html"><strong aria-hidden="true">8.</strong> Dockerisation d'un langage inconnu</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/ms_builds.html"><strong aria-hidden="true">9.</strong> Builds Multistage</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/communication.html"><strong aria-hidden="true">10.</strong> Communication entre plusieurs containers</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/env.html"><strong aria-hidden="true">11.</strong> Environnement</a></li><li class="chapter-item expanded "><a href="../../exercises/docker/healthcheck.html"><strong aria-hidden="true">12.</strong> Healthcheck</a></li><li class="chapter-item expanded affix "><li class="part-title">Docker Compose</li><li class="chapter-item expanded "><a href="../../exercises/compose/communication.html"><strong aria-hidden="true">13.</strong> Communication de Containers</a></li><li class="chapter-item expanded "><a href="../../exercises/compose/first_app.html"><strong aria-hidden="true">14.</strong> Premiere Application</a></li><li class="chapter-item expanded "><a href="../../exercises/compose/env.html"><strong aria-hidden="true">15.</strong> Environment</a></li><li class="chapter-item expanded "><a href="../../exercises/compose/healthcheck.html"><strong aria-hidden="true">16.</strong> Healthcheck</a></li><li class="chapter-item expanded affix "><li class="part-title">Kubernetes</li><li class="chapter-item expanded "><a href="../../course/k8s/hello_kind.html"><strong aria-hidden="true">17.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../course/k8s/first_deployment.html" class="active"><strong aria-hidden="true">18.</strong> Premier Deploiement</a></li><li class="chapter-item expanded "><a href="../../course/k8s/manifests.html"><strong aria-hidden="true">19.</strong> Premier Manifest</a></li><li class="chapter-item expanded affix "><li class="part-title">Controles</li><li class="chapter-item expanded "><a href="../../quizzes/final_docker.html"><strong aria-hidden="true">20.</strong> Final Docker Quiz</a></li><li class="chapter-item expanded "><a href="../../quizzes/final_kubernetes.html"><strong aria-hidden="true">21.</strong> Final Kubernetes Quiz</a></li><li class="chapter-item expanded "><a href="../../assessment.html"><strong aria-hidden="true">22.</strong> Docker Project</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Docker-K8s</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction-à-kubernetes"><a class="header" href="#introduction-à-kubernetes">Introduction à Kubernetes</a></h1>
<h2 id="introduction"><a class="header" href="#introduction">Introduction</a></h2>
<p>Dans Kubernetes, nous exécutons des conteneurs, mais nous ne gérons pas les conteneurs directement. Les conteneurs sont plutôt placés à l'intérieur de <code>pods</code>. Un <code>pod</code> <em>contient</em> des conteneurs.</p>
<p>Les pods sont à leur tour gérés par des contrôleurs, le plus courant étant appelé un <code>deployment</code> (déploiement).</p>
<p>Et afin de rendre l'application accessible depuis l'extérieur, nous utilisons un <code>service</code>. Ne t'inquiète pas si tu te sens un peu dépassé, nous les aborderons en détail plus tard dans le cours.</p>
<p>Les ressources Kubernetes sont déclarées dans ce qu'on appelle des <code>manifests</code> (manifestes) qui utilisent un langage de balisage appelé <code>yaml</code> pour exprimer l'état désiré des ressources.</p>
<h3 id="impératif-vs-déclaratif"><a class="header" href="#impératif-vs-déclaratif">Impératif vs Déclaratif</a></h3>
<p>Vous pouvez utiliser la CLI Kubernetes pour créer, supprimer et modifier des ressources de deux manières : impérative et déclarative.</p>
<p>De manière <strong>impérative</strong> signifie que vous <em>créez, supprimez et modifiez</em> activement les ressources. Et si par exemple vous exécutez une commande de création deux fois, vous vous retrouverez avec une ressource et un message d'erreur "échec de la création", car elle est déjà créée.</p>
<p>De manière <strong>déclarative</strong> signifie que vous <em>déclarez ce que vous voulez</em>, et <em>non comment</em> Kubernetes devrait le faire. Si vous exécutez la même commande deux fois, vous vous retrouverez avec une seule ressource. C'est parce que Kubernetes satisfera votre état désiré, et s'il existe déjà, il ne le créera pas à nouveau.</p>
<p>Faire les choses de manière <strong>impérative</strong> est acceptable pour <em>bidouiller</em> des choses, mais la plupart du temps, nous voulons travailler avec Kubernetes de manière <strong>déclarative</strong>.</p>
<p>Par conséquent, nous préférons de loin faire les choses de manière <strong>déclarative</strong>.
De manière déclarative signifie que nous <em>déclarons ce que nous voulons</em>, et <em>non comment</em> Kubernetes devrait le faire.</p>
<p>Cette déclaration est ce que nous appelons notre <code>état désiré</code> (desired state).</p>
<h3 id="interagir-avec-kubernetes-en-utilisant-kubectl"><a class="header" href="#interagir-avec-kubernetes-en-utilisant-kubectl">Interagir avec Kubernetes en utilisant kubectl</a></h3>
<p>Nous allons interagir avec Kubernetes en utilisant la ligne de commande.</p>
<p>La CLI Kubernetes s'appelle <code>kubectl</code>, et nous permet de gérer nos applications et Kubernetes lui-même.</p>
<p>Pour l'utiliser, tapez <code>kubectl &lt;sous-commande&gt; &lt;options&gt;</code> dans un terminal.</p>
<h2 id="État-désiré"><a class="header" href="#État-désiré">État Désiré</a></h2>
<p>L'état désiré est l'un des concepts fondamentaux de Kubernetes. C'est l'état dans lequel vous voulez que votre cluster soit. C'est l'état que vous définissez dans vos manifestes Kubernetes. Cela signifie que le cluster essaiera continuellement de satisfaire votre état désiré, même s'il n'est jamais possible de l'atteindre.</p>
<p>Dans cet exercice, vous appliquerez des manifestes Kubernetes à votre cluster et apprendrez comment Kubernetes satisfait votre état désiré.</p>
<h3 id="contrôleurs"><a class="header" href="#contrôleurs">Contrôleurs</a></h3>
<p>Les contrôleurs Kubernetes sont les composants qui satisfont votre état désiré. Comme exemple que nous utiliserons ici, un contrôleur de déploiement tentera de faire en sorte que le nombre de pods que vous avez défini dans votre manifeste soit toujours en cours d'exécution dans le cluster.</p>
<h3 id="objectifs-dapprentissage"><a class="header" href="#objectifs-dapprentissage">Objectifs d'apprentissage</a></h3>
<ul>
<li>Appliquer des manifestes Kubernetes en utilisant <code>kubectl apply -f &lt;fichier&gt;</code>.</li>
<li>Vérifier la promesse de Kubernetes de satisfaire votre état désiré.</li>
</ul>
<h2 id="exercice"><a class="header" href="#exercice">Exercice</a></h2>
<h3 id="vue-densemble"><a class="header" href="#vue-densemble">Vue d'ensemble</a></h3>
<ul>
<li>Inspecter un manifeste Kubernetes existant pour un objet <code>deployment</code>.</li>
<li>Appliquer le manifeste en utilisant la commande <code>kubectl apply</code>.</li>
<li>Supprimer un pod géré par le contrôleur de déploiement.</li>
<li>Observer qu'un nouveau pod est créé à sa place par le contrôleur.</li>
</ul>
<h3 id="instructions-étape-par-étape"><a class="header" href="#instructions-étape-par-étape">Instructions étape par étape</a></h3>
<details>
<summary>
Étape par étape :
</summary>
<h2 id="inspecter-un-manifeste-kubernetes-existant-pour-un-objet-deployment"><a class="header" href="#inspecter-un-manifeste-kubernetes-existant-pour-un-objet-deployment">Inspecter un manifeste Kubernetes existant pour un objet <code>deployment</code></a></h2>
<p>Ci-dessous se trouve le contenu du manifeste :</p>
<pre><code class="language-yaml"># tout ce qui suit un `#` est un commentaire !
apiVersion: apps/v1
kind: Deployment # Type de ressource : Déploiement
metadata:
  name: nginx # nom de la ressource de déploiement, les pods exécutés dans le cadre du déploiement partageront ce nom.
  labels:
    app: nginx # étiquette de la ressource de déploiement
spec:
  replicas: 1 # nombre de pods à exécuter
  selector:
    matchLabels: # étiquettes que le replicaset recherche
      app: nginx
  template: # Modèle de pod
    metadata:
      labels:
        app: nginx # étiquettes du pod qui doivent correspondre au sélecteur
        version: latest # étiquette arbitraire sur laquelle nous pouvons faire correspondre ailleurs
    spec:
      containers:
        - name: nginx # nom du conteneur exécuté à l'intérieur d'un pod, différent du nom du pod
          image: nginx:latest # image du conteneur
          ports:
            - containerPort: 80 # port sur lequel le conteneur écoute
</code></pre>
<h2 id="appliquer-le-manifeste-en-utilisant-kubectl-apply"><a class="header" href="#appliquer-le-manifeste-en-utilisant-kubectl-apply">Appliquer le manifeste en utilisant <code>kubectl apply</code></a></h2>
<p>Copiez le manifeste dans un fichier <code>nginx-deployment.yaml</code>.</p>
<p>Utilisez la commande <code>kubectl apply -f &lt;fichier&gt;</code> pour envoyer le manifeste avec votre état désiré à Kubernetes :</p>
<pre><code class="language-shell">kubectl apply -f nginx-deployment.yaml
</code></pre>
<p>Sortie attendue :</p>
<pre><code class="language-text">deployment.apps/nginx applied
</code></pre>
<p>Vérifiez que le déploiement est créé :</p>
<pre><code class="language-shell">kubectl get deployments
</code></pre>
<p>Sortie attendue :</p>
<pre><code class="language-text">NAME      READY   UP-TO-DATE   AVAILABLE   AGE
nginx     1/1     1            1           36s
</code></pre>
<blockquote>
<p>Attention, cette sortie peut prendre du temps a apparaitre
(environ 91s sur ma machine)</p>
</blockquote>
<p>Vérifiez si les pods sont en cours d'exécution :</p>
<pre><code class="language-shell">kubectl get pods
</code></pre>
<p>Sortie attendue (le nom exact du pod variera) :</p>
<pre><code class="language-text">NAME                     READY   STATUS    RESTARTS   AGE
nginx-431080787-9r0lx    1/1     Running   0          40s
</code></pre>
<p>Kubernetes fait maintenant tout son possible pour satisfaire notre état désiré d'exécuter notre serveur web nginx.</p>
<p>Testons que Kubernetes tient réellement sa promesse de satisfaire l'état désiré.</p>
<h2 id="tester-la-promesse-détat-désiré-de-kubernetes-en-supprimant-un-pod"><a class="header" href="#tester-la-promesse-détat-désiré-de-kubernetes-en-supprimant-un-pod">Tester la promesse d'état désiré de Kubernetes en supprimant un pod</a></h2>
<p>Comme nous avons demandé à Kubernetes d'exécuter notre pod nginx en utilisant un <code>deployment</code>, le contrôleur de déploiement continuera de surveiller nos pods et s'assurera qu'un pod nginx reste en cours d'exécution.</p>
<p>Voyons cela en action :</p>
<p>Nous utiliserons la commande <code>kubectl delete &lt;type&gt; &lt;nom&gt;</code> pour supprimer notre pod nginx.</p>
<p>Nous nous attendons ensuite à ce qu'un nouveau pod soit créé par le contrôleur de déploiement à sa place.</p>
<p>Tout d'abord, trouvez le nom de votre pod en utilisant <code>kubectl get pods</code>, comme vous l'avez fait ci-dessus.</p>
<p>Le nom sera quelque chose comme <code>nginx-431080787-9r0lx</code>. <strong>Le vôtre aura un nom différent, mais similaire</strong>.</p>
<pre><code class="language-shell"># Remplacez le nom ci-dessous par le nom réel de VOTRE pod
kubectl delete pod nginx-431080787-9r0lx
</code></pre>
<p>Sortie attendue :</p>
<pre><code class="language-text">pod "nginx-431080787-9r0lx" deleted
</code></pre>
<p>L'état désiré que nous avons défini spécifie qu'exactement un pod nginx doit exister. Puisque nous avons maintenant supprimé le pod nginx, nous avons forcé notre <code>deployment</code> à s'éloigner de l'état désiré, car il y a maintenant zéro pod nginx.</p>
<p>Par conséquent, Kubernetes doit apporter une modification à l'état du cluster pour satisfaire à nouveau notre état désiré. Kubernetes créera donc un nouveau pod nginx pour remplacer celui que nous avons supprimé.</p>
<h2 id="observer-quun-nouveau-pod-est-créé-à-sa-place-par-le-contrôleur-de-déploiement"><a class="header" href="#observer-quun-nouveau-pod-est-créé-à-sa-place-par-le-contrôleur-de-déploiement">Observer qu'un nouveau pod est créé à sa place par le contrôleur de déploiement</a></h2>
<p>Nous utilisons <code>kubectl get</code> pour vérifier qu'un <strong>nouveau</strong> pod nginx est créé (avec un nom différent) :</p>
<pre><code class="language-shell">kubectl get pods
</code></pre>
<p>Sortie attendue (le nom exact du pod variera) :</p>
<pre><code class="language-text">NAME                     READY   STATUS              RESTARTS   AGE
nginx-431080787-tx5m7    0/1     ContainerCreating   0          5s
</code></pre>
<p>Et après quelques secondes de plus :</p>
<pre><code class="language-shell">kubectl get pods
</code></pre>
<p>Sortie attendue (le nom exact du pod variera) :</p>
<pre><code class="language-text">NAME                     READY   STATUS    RESTARTS   AGE
nginx-431080787-tx5m7    1/1     Running   0          12s
</code></pre>
<p>Félicitations ! Vous avez maintenant créé un déploiement en utilisant un manifeste Kubernetes.</p>
<p>Vous avez également vu que Kubernetes tient sa promesse de satisfaire votre état désiré, en créant un nouveau pod à la place du pod supprimé.</p>
</details>
<h3 id="nettoyage"><a class="header" href="#nettoyage">Nettoyage</a></h3>
<p>Supprimez votre état désiré en utilisant la commande <code>kubectl delete -f &lt;fichier&gt;</code>.</p>
<pre><code class="language-text">kubectl delete -f nginx-deployment.yaml
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../course/k8s/hello_kind.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../course/k8s/manifests.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../course/k8s/hello_kind.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../course/k8s/manifests.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
