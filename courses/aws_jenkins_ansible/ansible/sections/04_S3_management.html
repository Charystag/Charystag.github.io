<!DOCTYPE HTML>
<html lang="fr" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Gestion de S3 avec ansible - Formation AWS Jenkins &amp; Ansible</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../../aws/introduction.html"><strong aria-hidden="true">1.</strong> Présentation générale d'AWS</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../aws/sections/01_introduction.html"><strong aria-hidden="true">1.1.</strong> Introduction sur AWS</a></li><li class="chapter-item expanded "><a href="../../aws/sections/02_AWS_overview.html"><strong aria-hidden="true">1.2.</strong> Les Bases d'AWS</a></li><li class="chapter-item expanded "><a href="../../aws/sections/03_AWS_EC2.html"><strong aria-hidden="true">1.3.</strong> Les Instances EC2</a></li><li class="chapter-item expanded "><a href="../../aws/sections/04_AWS_S3.html"><strong aria-hidden="true">1.4.</strong> Les Buckets S3</a></li></ol></li><li class="chapter-item expanded "><a href="../../jenkins/introduction.html"><strong aria-hidden="true">2.</strong> Présentation générale de Jenkins</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../jenkins/sections/01_Introduction.html"><strong aria-hidden="true">2.1.</strong> Introduction sur Jenkins</a></li><li class="chapter-item expanded "><a href="../../jenkins/sections/02_First_Steps.html"><strong aria-hidden="true">2.2.</strong> Premiers pas avec Jenkins</a></li><li class="chapter-item expanded "><a href="../../jenkins/sections/03_Pipelines.html"><strong aria-hidden="true">2.3.</strong> Les bases des Pipelines</a></li><li class="chapter-item expanded "><a href="../../jenkins/sections/04_Pipelines_Advanced.html"><strong aria-hidden="true">2.4.</strong> Plus de pipelines!</a></li><li class="chapter-item expanded "><a href="../../jenkins/sections/05_modules_libraries.html"><strong aria-hidden="true">2.5.</strong> Modules et librairies dans Jenkins</a></li><li class="chapter-item expanded "><a href="../../jenkins/sections/06_AWS_automation.html"><strong aria-hidden="true">2.6.</strong> Automatisation dans AWS</a></li><li class="chapter-item expanded "><a href="../../jenkins/sections/07_Real_Life_Example.html"><strong aria-hidden="true">2.7.</strong> Application concrète</a></li></ol></li><li class="chapter-item expanded "><a href="../../ansible/introduction.html"><strong aria-hidden="true">3.</strong> Présentation générale d'Ansible</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../ansible/sections/01_Introduction.html"><strong aria-hidden="true">3.1.</strong> Introduction à Ansible</a></li><li class="chapter-item expanded "><a href="../../ansible/sections/02_Basics.html"><strong aria-hidden="true">3.2.</strong> Bases d'ansible</a></li><li class="chapter-item expanded "><a href="../../ansible/sections/03_Automation.html"><strong aria-hidden="true">3.3.</strong> Automatisation avec ansible</a></li><li class="chapter-item expanded "><a href="../../ansible/sections/04_S3_management.html" class="active"><strong aria-hidden="true">3.4.</strong> Gestion de S3 avec ansible</a></li><li class="chapter-item expanded "><a href="../../ansible/sections/05_Jenkins_AWS_Pipeline.html"><strong aria-hidden="true">3.5.</strong> Ansible dans une pipeline Jenkins</a></li><li class="chapter-item expanded "><a href="../../ansible/sections/06_Best_Practices.html"><strong aria-hidden="true">3.6.</strong> Meilleures pratiques pour Ansible</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Formation AWS Jenkins &amp; Ansible</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h2 id="partie-4--playbooks-avancés-pour-aws-avec-s3"><a class="header" href="#partie-4--playbooks-avancés-pour-aws-avec-s3">Partie 4 : Playbooks Avancés pour AWS avec S3</a></h2>
<h3 id="objectifs"><a class="header" href="#objectifs">Objectifs</a></h3>
<p>Dans cette partie, vous allez :</p>
<ul>
<li>Découvrir comment automatiser les tâches de gestion de stockage dans AWS S3 avec Ansible.</li>
<li>Apprendre à créer, configurer et gérer les fichiers et les artefacts dans des buckets S3.</li>
<li>Utiliser les bonnes pratiques de sécurité et d’optimisation pour gérer les permissions et les coûts de stockage.</li>
</ul>
<hr />
<h3 id="41-introduction-à-la-gestion-de-s3-avec-ansible"><a class="header" href="#41-introduction-à-la-gestion-de-s3-avec-ansible">4.1 Introduction à la Gestion de S3 avec Ansible</a></h3>
<p>S3 est un service de stockage d'objets dans AWS, utile pour conserver des artefacts, des fichiers de configuration, des logs, et plus encore. En utilisant Ansible, nous pouvons automatiser les tâches de gestion de S3, ce qui facilite le stockage et l’organisation de fichiers de manière centralisée.</p>
<h4 id="concepts-clés"><a class="header" href="#concepts-clés">Concepts clés</a></h4>
<ul>
<li><strong>Utilisation de S3</strong> : S3 permet de stocker, organiser et partager des fichiers de manière efficace, tout en garantissant leur sécurité.</li>
<li><strong>Modules Ansible pour S3</strong> : Le module <code>aws_s3</code> permet de créer, configurer et gérer des buckets S3.</li>
</ul>
<hr />
<h3 id="42-création-et-configuration-de-buckets-s3"><a class="header" href="#42-création-et-configuration-de-buckets-s3">4.2 Création et Configuration de Buckets S3</a></h3>
<h4 id="création-de-buckets-s3-avec-ansible"><a class="header" href="#création-de-buckets-s3-avec-ansible">Création de Buckets S3 avec Ansible</a></h4>
<p>Le module <code>aws_s3</code> permet de créer des buckets directement depuis Ansible, en évitant de passer par la console AWS.</p>
<p><strong>Exercice</strong> : Écrire un playbook pour créer un bucket S3 avec des paramètres personnalisés.</p>
<p><strong>Objectif</strong> : Créer un bucket S3 avec un nom unique et configurer la région.</p>
<ol>
<li>Créez un playbook nommé <code>create_bucket.yml</code>.</li>
<li>Utilisez le module <code>aws_s3</code> pour spécifier le nom et la région du bucket.</li>
</ol>
<p><strong>Exemple de playbook</strong> :</p>
<pre><code class="language-yaml">- name: Créer un bucket S3 avec Ansible
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Créer le bucket S3
      aws_s3:
        bucket: "my-ansible-bucket"
        mode: create
        region: "us-west-2"
</code></pre>
<h4 id="configuration-des-permissions-et-politiques-de-sécurité"><a class="header" href="#configuration-des-permissions-et-politiques-de-sécurité">Configuration des Permissions et Politiques de Sécurité</a></h4>
<p>Les permissions et les politiques de sécurité S3 permettent de restreindre l'accès aux ressources du bucket. Avec Ansible, vous pouvez configurer des règles de sécurité précises pour contrôler qui peut accéder aux fichiers stockés dans S3.</p>
<p><strong>Exercice</strong> : Configurer un playbook pour définir des permissions spécifiques sur un bucket S3</p>
<p><strong>Objectif</strong> : Limiter l’accès au bucket à des rôles IAM spécifiques.</p>
<ol>
<li>Ajoutez une politique de sécurité dans le playbook pour restreindre l'accès aux utilisateurs autorisés.</li>
</ol>
<p><strong>Exemple de configuration des permissions</strong> :</p>
<pre><code class="language-yaml">- name: Configurer les permissions du bucket S3
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Appliquer une politique de sécurité au bucket S3
      aws_s3:
        bucket: "my-ansible-bucket"
        policy: |
          {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Principal": {
                  "AWS": "arn:aws:iam::123456789012:role/MyRole"
                },
                "Action": "s3:*",
                "Resource": "arn:aws:s3:::my-ansible-bucket/*"
              }
            ]
          }
        mode: put
</code></pre>
<hr />
<h3 id="43-gestion-des-fichiers-dans-s3-avec-ansible"><a class="header" href="#43-gestion-des-fichiers-dans-s3-avec-ansible">4.3 Gestion des Fichiers dans S3 avec Ansible</a></h3>
<h4 id="téléversement-et-téléchargement-de-fichiers-dans-s3"><a class="header" href="#téléversement-et-téléchargement-de-fichiers-dans-s3">Téléversement et Téléchargement de Fichiers dans S3</a></h4>
<p>Le module <code>aws_s3</code> peut être utilisé pour téléverser ou télécharger des fichiers dans S3, facilitant ainsi le stockage d’artefacts, de logs et de configurations.</p>
<p><strong>Exercice</strong> : Écrire un playbook pour téléverser des fichiers de logs vers un bucket S3</p>
<p><strong>Objectif</strong> : Uploader des logs générés par un playbook de configuration dans un bucket S3 pour stockage et analyse.</p>
<ol>
<li>Créez un playbook nommé <code>upload_logs.yml</code>.</li>
<li>Ajoutez une tâche pour uploader un fichier de logs dans le bucket S3.</li>
</ol>
<p><strong>Exemple de playbook pour l’upload de fichiers</strong> :</p>
<pre><code class="language-yaml">- name: Uploader des logs dans S3
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Uploader le fichier de logs
      aws_s3:
        bucket: "my-ansible-bucket"
        object: "logs/deployment.log"
        src: "/path/to/local/deployment.log"
        mode: put
</code></pre>
<h4 id="organisation-et-gestion-des-objets-s3"><a class="header" href="#organisation-et-gestion-des-objets-s3">Organisation et Gestion des Objets S3</a></h4>
<p>Les fichiers peuvent être organisés dans S3 en utilisant des préfixes et des sous-dossiers virtuels, ce qui facilite leur gestion et leur récupération.</p>
<p><strong>Exercice</strong> : Configurer un playbook pour organiser les artefacts d’un déploiement CI/CD dans un bucket S3</p>
<p><strong>Objectif</strong> : Stocker les artefacts par projet et date pour faciliter le suivi.</p>
<ol>
<li>Créez un playbook pour organiser les fichiers d’un déploiement avec des préfixes pour chaque projet et date.</li>
</ol>
<hr />
<h3 id="44-gestion-des-versions-et-de-la-rétention-des-objets"><a class="header" href="#44-gestion-des-versions-et-de-la-rétention-des-objets">4.4 Gestion des Versions et de la Rétention des Objets</a></h3>
<h4 id="activer-et-gérer-le-versioning-dans-un-bucket-s3"><a class="header" href="#activer-et-gérer-le-versioning-dans-un-bucket-s3">Activer et Gérer le Versioning dans un Bucket S3</a></h4>
<p>Le versioning dans S3 permet de conserver différentes versions d'un même fichier, utile pour les mises à jour fréquentes ou la conservation de configurations.</p>
<p><strong>Exercice</strong> : Écrire un playbook pour activer le versioning et configurer la rétention</p>
<p><strong>Objectif</strong> : Activer le versioning sur un bucket S3 et définir des règles de cycle de vie pour la suppression automatique.</p>
<ol>
<li>Ajoutez des paramètres de versioning et de cycle de vie dans votre playbook pour activer la gestion de la rétention.</li>
</ol>
<p><strong>Exemple de playbook pour le versioning et la rétention</strong> :</p>
<pre><code class="language-yaml">- name: Activer le versioning et configurer la rétention
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Activer le versioning sur le bucket S3
      aws_s3:
        bucket: "my-ansible-bucket"
        versioning: yes
        mode: put

    - name: Configurer la règle de cycle de vie pour le nettoyage automatique
      aws_s3:
        bucket: "my-ansible-bucket"
        lifecycle:
          - id: "Retain non-current versions"
            status: "Enabled"
            noncurrentVersionExpiration:
              noncurrentDays: 30
</code></pre>
<hr />
<h3 id="45-défis-et-bonnes-pratiques-pour-lautomatisation-de-s3-avec-ansible"><a class="header" href="#45-défis-et-bonnes-pratiques-pour-lautomatisation-de-s3-avec-ansible">4.5 Défis et Bonnes Pratiques pour l’Automatisation de S3 avec Ansible</a></h3>
<h4 id="gestion-des-permissions-et-des-politiques-de-sécurité"><a class="header" href="#gestion-des-permissions-et-des-politiques-de-sécurité">Gestion des Permissions et des Politiques de Sécurité</a></h4>
<p>Adoptez les meilleures pratiques pour sécuriser les accès aux fichiers stockés dans S3. Utilisez des stratégies de bucket pour limiter les accès aux rôles IAM autorisés et assurez-vous que les permissions sont minimales.</p>
<h4 id="optimisation-des-coûts-de-stockage"><a class="header" href="#optimisation-des-coûts-de-stockage">Optimisation des Coûts de Stockage</a></h4>
<p>S3 propose plusieurs classes de stockage (Standard, Intelligent-Tiering, Glacier) pour gérer les coûts en fonction de l’utilisation des fichiers.</p>
<p><strong>Exercice</strong> : Écrire un playbook pour configurer le cycle de vie d’un bucket S3 et déplacer les fichiers peu utilisés</p>
<p><strong>Objectif</strong> : Configurer des règles pour déplacer automatiquement les fichiers rarement consultés vers une classe de stockage moins coûteuse.</p>
<ol>
<li>Ajoutez une règle de cycle de vie dans votre playbook pour transférer les fichiers après une certaine période vers Glacier.</li>
</ol>
<p><strong>Exemple de playbook pour l’optimisation des coûts</strong> :</p>
<pre><code class="language-yaml">- name: Configurer le cycle de vie pour réduire les coûts de stockage
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Ajouter une règle de cycle de vie
      aws_s3:
        bucket: "my-ansible-bucket"
        lifecycle:
          - id: "Transition to Glacier"
            status: "Enabled"
            transitions:
              - days: 90
                storageClass: "GLACIER"
</code></pre>
<hr />
<h3 id="liens-vers-la-documentation"><a class="header" href="#liens-vers-la-documentation">Liens vers la Documentation</a></h3>
<ul>
<li><a href="https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_s3_module.html">Documentation du module <code>aws_s3</code> dans Ansible</a></li>
<li><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/lifecycle-configuration-examples.html">Documentation des stratégies de cycle de vie S3</a> [<a href="https://docs.aws.amazon.com/fr_fr/AmazonS3/latest/userguide/lifecycle-configuration-examples.html"><em>fr</em></a>]</li>
<li><a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/security-best-practices.html">Guide des permissions et sécurité S3</a></li>
</ul>
<hr />
<h3 id="questions-de-révision"><a class="header" href="#questions-de-révision">Questions de Révision</a></h3>
<details>
<summary><h3 style="display:inline-block">Questions de Révision</h3></summary>
<details>
<summary>Quel module Ansible permet de gérer les buckets et fichiers S3 ?</summary>
<details>
<summary>Solution</summary>
Le module `aws_s3` permet de créer des buckets, de téléverser ou télécharger des fichiers, et de configurer des règles de cycle
<p>de vie et de versioning pour S3.</p>
</details>
</details>
<details>
<summary>Comment configure-t-on des permissions spécifiques pour un bucket S3 avec Ansible ?</summary>
<details>
<summary>Solution</summary>
On peut configurer les permissions en utilisant des stratégies de sécurité (policies) directement dans le module `aws_s3` pour définir qui peut accéder aux objets du bucket.
</details>
</details>
<details>
<summary>Qu’est-ce que le versioning dans un bucket S3 et pourquoi est-il utile ?</summary>
<details>
<summary>Solution</summary>
Le versioning permet de conserver plusieurs versions d'un même fichier, ce qui est utile pour suivre les modifications ou pour restaurer d'anciennes versions en cas de suppression accidentelle.
</details>
</details>
</details>
<hr />
<h3 id="conseils-pratiques"><a class="header" href="#conseils-pratiques">Conseils Pratiques</a></h3>
<ol>
<li><strong>Utilisez des noms uniques pour les buckets S3</strong> : Les noms de buckets sont globaux et doivent être uniques dans AWS.</li>
<li><strong>Appliquez le principe de moindre privilège pour les rôles IAM</strong> : Assurez-vous que les rôles IAM utilisés pour gérer S3 ne disposent que des permissions nécessaires.</li>
<li><strong>Mettez en place des règles de cycle de vie pour optimiser les coûts de stockage</strong> : Les règles de cycle de vie automatisent le transfert de fichiers vers des classes de stockage moins coûteuses.
<a href="https://aws.amazon.com/s3/storage-classes/">Plus de détails sur la gestion des coûts dans S3</a> [<a href="https://aws.amazon.com/fr/s3/storage-classes/"><em>fr</em></a>]</li>
</ol>
<hr />
<h3 id="défi-intermédiaire"><a class="header" href="#défi-intermédiaire">Défi Intermédiaire</a></h3>
<details>
<summary><h3 style="display:inline-block">Défi Intermédiaire</h3></summary>
**Objectif** : Créer un playbook pour gérer un bucket S3 avec versioning, politiques de sécurité et règles de cycle de vie.
<p><strong>Contexte</strong> : Vous devez créer un bucket S3 pour stocker des artefacts et configurer le versioning, des règles de sécurité, et une politique de cycle de vie pour optimiser les coûts de stockage.</p>
<details>
<summary><b>Étapes principales</b></summary>
1. Créez un playbook nommé `manage_s3.yml`.
2. Utilisez le module `aws_s3` pour créer un bucket et activer le versioning.
3. Configurez une politique de sécurité pour restreindre les accès.
4. Ajoutez une règle de cycle de vie pour transférer les fichiers vers Glacier après 90 jours.
</details>
<p><strong>Compétences renforcées</strong> :</p>
<ul>
<li>Gestion avancée des buckets S3</li>
<li>Application des politiques de sécurité et de cycle de vie</li>
</ul>
<details>
<summary><b>Solution suggérée</b></summary>
Utilisez un playbook semblable à ceci :
<pre><code class="language-yaml">- name: Gestion avancée d'un bucket S3
  hosts: localhost
  gather_facts: false
  tasks:
    - name: Créer le bucket avec versioning
      aws_s3:
        bucket: "my-advanced-bucket"
        versioning: yes
        mode: create
        region: "us-west-2"

    - name: Appliquer une politique de sécurité au bucket
      aws_s3:
        bucket: "my-advanced-bucket"
        policy: |
          {
            "Version": "2012-10-17",
            "Statement": [
              {
                "Effect": "Allow",
                "Principal": {
                  "AWS": "arn:aws:iam::123456789012:role/MyRole"
                },
                "Action": "s3:*",
                "Resource": "arn:aws:s3:::my-advanced-bucket/*"
              }
            ]
          }
        mode: put

    - name: Configurer le cycle de vie pour optimiser les coûts
      aws_s3:
        bucket: "my-advanced-bucket"
        lifecycle:
          - id: "Transition to Glacier"
            status: "Enabled"
            transitions:
              - days: 90
                storageClass: "GLACIER"
</code></pre>
</details>
</details>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../ansible/sections/03_Automation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../ansible/sections/05_Jenkins_AWS_Pipeline.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../ansible/sections/03_Automation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../ansible/sections/05_Jenkins_AWS_Pipeline.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
